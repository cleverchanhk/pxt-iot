{"entries":[{"timestamp":1745426496928,"editorVersion":"7.0.61","changes":[{"type":"edited","filename":"main.blocks","patch":[{"diffs":[[0,"http"],[-1,"s"],[0,"://"],[-1,"developers.google.com/blockly/xml\"><variables></variables>"],[1,"www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n"],[0,"</xm"]],"start1":12,"start2":12,"length1":70,"length2":113}]},{"type":"edited","filename":"main.ts","patch":[{"diffs":[[-1,"enum HttpMethod {\n    GET,\n    POST,\n    PUT,\n    HEAD,\n    DELETE,\n    PATCH,\n    OPTIONS,\n    CONNECT,\n    TRACE\n}\n\n/**\n * IoT commands.\n */\n//% color=#34c3a2 weight=90 icon=\"\\uf1eb\" block=\"IoT\"\nnamespace IoT {\n\n    function writeToSerial(data: string, waitTime: number): void {\n        serial.writeString(data + \"\\u000D\" + \"\\u000A\")\n        if (waitTime > 0) {\n            basic.pause(waitTime)\n        }\n    }\n\n    let pauseBaseValue: number = 1000\n\n    /**\n     * Change HTTP method wait period.\n     * @param newPauseBaseValue Base value, eg: 1000\n     */\n    //% weight=1\n    export function changeHttpMethodWaitPeriod(newPauseBaseValue: number): void {\n        pauseBaseValue = newPauseBaseValue\n    }\n\n    let isWifiConnected = false\n    /**\n     * Make a serial connection between micro:bit and ESP8266.\n     */\n    //% weight=100\n    //% blockId=\"ESP8266_connect\" block=\"connect to ESP8266\"\n    export function Initialize_ESP8266(txPin: SerialPin, rxPin: SerialPin, baudRate: BaudRate, ssid: string, passwd: string): void {\n        let result = 0\n\n        isWifiConnected = false\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n        sendAtCmd(\"AT\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(`AT+CWJAP=\"${ssid}\",\"${passwd}\"`)\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n\n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n    /**\n     * Check if it is connected to Wifi\n     */\n    //% block=\"Wifi OK?\"\n    export function wifiOK() {\n        return isWifiConnected\n    }\n\n    /**\n     * Disconnect from WiFi network.\n     */\n    //% weight=98\n    //% blockId=\"wfb_wifi_off\" block=\"disconnect from WiFi network\"\n    export function disconnectFromWiFiNetwork(): void {\n        // Disconnect from AP:\n        writeToSerial(\"AT+CWQAP\", 6000)\n    }\n\n    /**\n     * Execute HTTP method.\n     * @param method HTTP method, eg: HttpMethod.GET\n     * @param host Host, eg: \"google.com\"\n     * @param port Port, eg: 80\n     * @param urlPath Path, eg: \"api/search?q=something\"\n     * @param parameter_name_1 Name of paramter 1\n     * @param parameter_1 Value of paramter 1\n     * @param parameter_name_2 Name of paramter 2\n     * @param parameter_2 Value of paramter 2\n     */\n    //% weight=96\n    //% blockId=\"wfb_http\" block=\"execute HTTP method %method|host: %host|port: %port|path: %urlPath||parameter_name_1: %parameter_name_1|parameter_1: %parameter_1|parameter_name_2: %parameter_name_2|parameter_2: %parameter_2\"\n    export function executeHttpMethod(method: HttpMethod, host: string, port: number, urlPath: string, parameter_name_1?: string, parameter_1?: number, parameter_name_2?: string, parameter_2?: number): void {\n        let myMethod: string\n        switch (method) {\n            case HttpMethod.GET: myMethod = \"GET\"; break;\n            case HttpMethod.POST: myMethod = \"POST\"; break;\n            case HttpMethod.PUT: myMethod = \"PUT\"; break;\n            case HttpMethod.HEAD: myMethod = \"HEAD\"; break;\n            case HttpMethod.DELETE: myMethod = \"DELETE\"; break;\n            case HttpMethod.PATCH: myMethod = \"PATCH\"; break;\n            case HttpMethod.OPTIONS: myMethod = \"OPTIONS\"; break;\n            case HttpMethod.CONNECT: myMethod = \"CONNECT\"; break;\n            case HttpMethod.TRACE: myMethod = \"TRACE\";\n        }\n        // Establish TCP connection:\n        let data: string = \"AT+CIPSTART=\\\"TCP\\\",\\\"\" + host + \"\\\",\" + port\n        writeToSerial(data, pauseBaseValue * 6)\n        data = myMethod + \" \" + urlPath\n        if (parameter_name_1 && parameter_name_1.length > 0) {\n            data += \"&\" + parameter_name_1 + \"=\" + parameter_1\n        }\n\n        data += \" HTTP/1.1\" + \"\\u000D\" + \"\\u000A\"\n            + \"Host: \" + host + \"\\u000D\" + \"\\u000A\"\n        // Send data:\n        writeToSerial(\"AT+CIPSEND=\" + (data.length + 2), pauseBaseValue * 3)\n        writeToSerial(data, pauseBaseValue * 6)\n        // Close TCP connection:\n        writeToSerial(\"AT+CIPCLOSE\", pauseBaseValue * 3)\n    }\n\n    function waitAtResponse(target1: string, target2: string, target3: string, timeout: number) {\n        let buffer = \"\"\n        let start = input.runningTime()\n\n        while ((input.runningTime() - start) < timeout) {\n            buffer += serial.readString()\n\n            if (buffer.includes(target1)) return 1\n            if (buffer.includes(target2)) return 2\n            if (buffer.includes(target3)) return 3\n\n            basic.pause(100)\n        }\n\n        return 0\n    }\n\n    function sendAtCmd(cmd: string) {\n        serial.writeString(cmd + \"\\u000D\\u000A\")\n    }\n}"],[1,"\n"]],"start1":0,"start2":0,"length1":4738,"length2":1}]},{"type":"edited","filename":"pxt.json","patch":[{"diffs":[[0,"   \""],[-1,"testFiles\": [\n        \"test.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\""],[1,"additionalFilePaths\": []"],[0,"\n}\n"]],"start1":231,"start2":231,"length1":76,"length2":31}]},{"type":"added","filename":"test.ts","value":"// 在這裡測試；當此封包作為擴充功能時，將不會編譯此內容。\n"}]}],"snapshots":[{"timestamp":1745426496927,"editorVersion":"7.0.61","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"pxt-IoT\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}}],"shares":[],"lastSaveTime":1745426815456}